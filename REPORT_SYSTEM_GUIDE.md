# ระบบแจ้งปัญหา (Report System)

## 📋 ภาพรวมระบบ

ระบบแจ้งปัญหาช่วยให้ร้านค้า (Seller) สามารถแจ้งปัญหาหรือข้อเสนอแนะต่อแอดมิน และติดตามสถานะการแก้ไขได้อย่างครบถ้วน

---

## 🎯 ฟีเจอร์หลัก

### 🛍️ สำหรับร้านค้า (Seller)

#### 1. แจ้งปัญหา
- เข้าเมนู **"แจ้งปัญหา"** (`/my-reports`)
- คลิกปุ่ม **"แจ้งปัญหาใหม่"**
- กรอกข้อมูล:
  - **หัวข้อ**: ชื่อปัญหาที่แจ้ง
  - **รายละเอียด**: อธิบายปัญหาอย่างละเอียด
  - **ประเภท**: 
    - 🐛 บั๊ก (Bug)
    - ⭐ ขอฟีเจอร์ใหม่ (Feature Request)
    - 💰 การชำระเงิน (Payment)
    - 👤 บัญชี (Account)
    - 📝 อื่นๆ (Other)
  - **ความสำคัญ**: ต่ำ, ปานกลาง, สูง
- กดส่ง

#### 2. ติดตามสถานะ
สถานะรายงาน:
- 🕒 **รอดำเนินการ** (Pending): รอแอดมินตรวจสอบ
- 🔄 **กำลังดำเนินการ** (In Progress): แอดมินกำลังแก้ไข
- ✅ **แก้ไขเสร็จสิ้น** (Resolved): แก้ไขปัญหาเรียบร้อยแล้ว
- ❌ **ปฏิเสธ** (Rejected): ไม่สามารถดำเนินการได้

#### 3. รับแจ้งเตือน
- เมื่อแอดมินอัปเดตสถานะ ระบบจะส่งแจ้งเตือนไปยังคุณอัตโนมัติ
- แจ้งเตือนจะแสดงที่เมนู **"แจ้งเตือน"**
- ข้อความแจ้งเตือนจะมี:
  - หัวข้อรายงาน
  - สถานะใหม่
  - หมายเหตุจากแอดมิน (ถ้ามี)

#### 4. ดูประวัติ
- ดูรายงานทั้งหมดที่เคยแจ้ง
- กรองตามสถานะ
- ดูรายละเอียดและหมายเหตุจากแอดมิน

---

### 🛡️ สำหรับแอดมิน (Admin)

#### 1. จัดการรายงาน
- เข้าเมนู **"รายงานปัญหา"** (`/reports`)
- ดูรายงานทั้งหมดจากผู้ใช้ทุกคน
- แสดงข้อมูล:
  - ผู้แจ้ง (อีเมล, ชื่อร้าน)
  - หัวข้อและรายละเอียด
  - ประเภทและความสำคัญ
  - วันที่แจ้ง

#### 2. อัปเดตสถานะ
- คลิก **"อัปเดตสถานะ"** ที่รายงานที่ต้องการ
- เลือกสถานะใหม่:
  - กำลังดำเนินการ
  - แก้ไขเสร็จสิ้น
  - ปฏิเสธ
- เพิ่มหมายเหตุ (ถ้ามี)
- **ระบบจะส่งแจ้งเตือนไปยังผู้แจ้งอัตโนมัติ**

#### 3. ดูสถิติ
Dashboard แสดง:
- จำนวนรายงานทั้งหมด
- จำนวนตามสถานะ (รอดำเนินการ, กำลังดำเนินการ, แก้ไขแล้ว, ปฏิเสธ)

#### 4. ลบรายงาน
- สามารถลบรายงานที่ไม่เหมาะสมหรือซ้ำซ้อน
- จะถูกบันทึกใน Activity Log

---

## 📱 หน้าจอและเมนู

### Seller
```
เมนู: "แจ้งปัญหา" (/my-reports)
- ดูรายงานของตัวเอง
- แจ้งปัญหาใหม่
- ติดตามสถานะ
- ดูหมายเหตุจาก Admin
```

### Admin
```
เมนู: "รายงานปัญหา" (/reports)
- ดูรายงานทั้งหมด
- อัปเดตสถานะ
- ลบรายงาน
- ดูสถิติ
```

---

## 🔔 การแจ้งเตือน

เมื่อแอดมินอัปเดตสถานะ:
1. ระบบจะสร้างการแจ้งเตือนไปยังผู้แจ้งทันที
2. ข้อความแจ้งเตือนจะแสดง:
   - หัวข้อรายงาน
   - สถานะใหม่
   - หมายเหตุจากแอดมิน
3. คลิกแจ้งเตือนจะนำไปหน้า "แจ้งปัญหา"

### ประเภทการแจ้งเตือน
- ℹ️ **Info**: อัปเดตสถานะทั่วไป (Pending, In Progress)
- ⚠️ **Warning**: รายงานถูกปฏิเสธ (Rejected)
- ✅ **Success**: รายงานแก้ไขเสร็จสิ้น (Resolved)

---

## 💾 โครงสร้างข้อมูล

### Collection: `reports`

```typescript
{
  id: string;                    // Document ID
  userId: string;                // UID ของผู้แจ้ง
  userEmail: string;             // อีเมลผู้แจ้ง
  shopName: string;              // ชื่อร้าน
  title: string;                 // หัวข้อ
  description: string;           // รายละเอียด
  priority: 'low' | 'medium' | 'high'; // ความสำคัญ
  category: 'bug' | 'feature' | 'payment' | 'account' | 'other';
  status: 'pending' | 'in-progress' | 'resolved' | 'rejected';
  adminNote?: string;            // หมายเหตุจาก Admin
  resolvedBy?: string;           // UID ของ Admin ที่แก้ไข
  createdAt: Timestamp;          // วันที่สร้าง
  updatedAt?: Timestamp;         // วันที่อัปเดตล่าสุด
  resolvedAt?: Timestamp;        // วันที่แก้ไขเสร็จ
}
```

---

## 🔧 API / ฟังก์ชัน

### `src/lib/reportUtils.ts`

#### สำหรับทั้ง Admin และ Seller
```typescript
// สร้างรายงานใหม่
createReport(userId, userEmail, shopName, data): Promise<{success, id, error}>

// ดึงรายงานของผู้ใช้
getReportsByUser(userId): Promise<Report[]>

// ดึงสถิติรายงาน
getReportStats(): Promise<Stats>
```

#### สำหรับ Admin เท่านั้น
```typescript
// ดึงรายงานทั้งหมด
getAllReports(): Promise<Report[]>

// อัปเดตสถานะ (จะส่งแจ้งเตือนอัตโนมัติ)
updateReportStatus(reportId, status, adminId?, adminNote?): Promise<{success, error}>

// ลบรายงาน
deleteReport(reportId, userInfo): Promise<{success, error}>
```

---

## ✅ ขั้นตอนการใช้งาน

### สำหรับร้านค้า
1. ✍️ ไปที่ **"แจ้งปัญหา"**
2. 🆕 คลิก **"แจ้งปัญหาใหม่"**
3. 📝 กรอกข้อมูลครบถ้วน
4. ✅ กดส่ง
5. 🔔 รอรับการแจ้งเตือนเมื่อแอดมินอัปเดตสถานะ

### สำหรับแอดมิน
1. 👀 ไปที่ **"รายงานปัญหา"**
2. 🔍 ตรวจสอบรายงานที่เข้ามา
3. 🔄 คลิก **"อัปเดตสถานะ"**
4. 📝 เลือกสถานะและเพิ่มหมายเหตุ
5. ✅ บันทึก (ระบบจะส่งแจ้งเตือนอัตโนมัติ)

---

## 🎨 UI Components

### หน้า MyReports (`/my-reports`)
- สถิติรายงานของตัวเอง (5 การ์ด)
- ตารางรายงาน พร้อม Badge สถานะ
- ฟิลเตอร์ตามสถานะ
- Dialog รายละเอียด
- Dialog สร้างรายงานใหม่

### หน้า Reports (`/reports`) - Admin
- สถิติรายงานทั้งหมด
- ตารางรายงานจากผู้ใช้ทั้งหมด
- Dialog อัปเดตสถานะ
- Dialog รายละเอียด

---

## 📌 Tips

### สำหรับร้านค้า
- 📸 **แนบข้อมูลให้ครบถ้วน** เพื่อให้แอดมินเข้าใจปัญหาได้ชัดเจน
- ⏰ **ตรวจสอบแจ้งเตือน** เป็นประจำเพื่อดูความคืบหน้า
- 🔔 **คลิกแจ้งเตือน** เพื่อดูรายละเอียดอัปเดต

### สำหรับแอดมิน
- 💬 **ใส่หมายเหตุ** ทุกครั้งเพื่อให้ผู้แจ้งเข้าใจสถานการณ์
- ⚡ **ตอบกลับเร็ว** เพื่อสร้างความประทับใจ
- 📊 **ตรวจสอบสถิติ** เพื่อจัดลำดับความสำคัญ

---

## 🔗 Related Files

```
src/
├── lib/
│   ├── reportUtils.ts          # API functions
│   └── notificationUtils.ts     # Notification functions
├── pages/
│   ├── Reports.tsx              # Admin page
│   └── MyReports.tsx            # Seller page
├── components/
│   └── CreateReportDialog.tsx   # Dialog สร้างรายงาน
└── types/
    └── notification.ts          # TypeScript types
```

---

## 🚀 Next Steps

1. ✅ Admin สามารถอัปเดตสถานะได้
2. ✅ ส่งแจ้งเตือนอัตโนมัติเมื่ออัปเดต
3. ✅ Seller มีหน้าดูประวัติของตัวเอง
4. ✅ แจ้งเตือนมี link ไปหน้า My Reports

---

**หมายเหตุ**: ระบบแจ้งปัญหาช่วยเพิ่มความเชื่อมั่นและความพึงพอใจของผู้ใช้ โดยให้พวกเขารู้ว่าปัญหาถูกดูแลและมีการติดตามผล 🎯


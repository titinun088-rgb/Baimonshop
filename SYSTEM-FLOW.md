# ğŸ”„ à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸£à¸°à¸šà¸š Coin-Zone à¹à¸šà¸šà¸¥à¸°à¹€à¸­à¸µà¸¢à¸”

## ğŸ¯ à¸ à¸²à¸à¸£à¸§à¸¡à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡ (Architecture Overview)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER BROWSER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (React + Vite)                                  â”‚  â”‚
â”‚  â”‚  - UI Components                                          â”‚  â”‚
â”‚  â”‚  - Firebase SDK (Auth, Firestore)                        â”‚  â”‚
â”‚  â”‚  - No API Keys! (à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢)                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â”‚ Firebase Auth (Login/Logout)        â”‚                 â”‚
â”‚         â”‚ - Google Sign-in                    â”‚                 â”‚
â”‚         â”‚ - Email/Password                    â”‚                 â”‚
â”‚         â”‚ - Returns: JWT Token (1 hour)       â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                              â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Vercel Edge Network (CDN + Serverless)        â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
      â”‚  â”‚  Backend Proxy (api/peamsub.ts)          â”‚  â”‚
      â”‚  â”‚  - Validates Firebase Token              â”‚  â”‚
      â”‚  â”‚  - Adds API Keys (from env vars)         â”‚  â”‚
      â”‚  â”‚  - Forwards to External APIs             â”‚  â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  External APIs                                 â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
      â”‚  â”‚  Peamsub API â”‚  â”‚ Slip2Go API  â”‚           â”‚
      â”‚  â”‚  (à¹€à¸•à¸´à¸¡à¹€à¸à¸¡)   â”‚  â”‚ (à¸•à¸£à¸§à¸ˆà¸ªà¸¥à¸´à¸›)   â”‚           â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Firebase Services                             â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
      â”‚  â”‚  Firestore   â”‚  â”‚   Storage    â”‚           â”‚
      â”‚  â”‚  (Database)  â”‚  â”‚   (Files)    â”‚           â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
      â”‚  Security Rules: à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“– Flow à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¹à¸•à¹ˆà¸¥à¸° Feature

### ğŸ” 1. Login Process (à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š)

```
Step 1: User à¸„à¸¥à¸´à¸ "Login with Google"
â”œâ”€ Frontend: src/pages/Login.tsx
â”‚  â””â”€ à¹€à¸£à¸µà¸¢à¸: signInWithPopup(auth, googleProvider)
â”‚
Step 2: Google Auth Popup
â”œâ”€ User à¹€à¸¥à¸·à¸­à¸ Google Account
â”œâ”€ Google à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š credentials
â””â”€ Google à¸ªà¹ˆà¸‡ tokens à¸à¸¥à¸±à¸šà¸¡à¸²
â”‚
Step 3: Firebase Authentication
â”œâ”€ Firebase à¸£à¸±à¸š Google tokens
â”œâ”€ à¸ªà¸£à¹‰à¸²à¸‡/à¸­à¸±à¸à¹€à¸”à¸— User à¹ƒà¸™ Firebase Auth
â””â”€ Generate JWT Token (exp: 1 hour)
â”‚
Step 4: Create User Document (à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µ)
â”œâ”€ Check: users/{uid} exists?
â”œâ”€ à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ:
â”‚  â””â”€ à¸ªà¸£à¹‰à¸²à¸‡ document à¹ƒà¸™ Firestore:
â”‚     {
â”‚       uid: "uwwxxblh...",
â”‚       email: "pongskon058@gmail.com",
â”‚       displayName: "355 à¸™à¸²à¸¢ à¸à¸‡à¸¨à¸à¸£ à¹à¸à¹‰à¸§à¸”à¸³",
â”‚       role: "user",
â”‚       balance: 0,
â”‚       createdAt: serverTimestamp()
â”‚     }
â”‚
Step 5: Redirect to Home
â””â”€ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š role â†’ redirect à¹„à¸› /home à¸«à¸£à¸·à¸­ /admin
```

**à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡:**
- `src/pages/Login.tsx` - UI login
- `src/lib/firebase.ts` - Firebase config
- `src/contexts/AuthContext.tsx` - State management
- `firestore.rules` (lines 42-72) - Security rules

**Firestore Rule à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰:**
```javascript
// Create user document (à¸•à¸­à¸™ register)
allow create: if isAuthenticated() && 
              request.auth.uid == userId &&
              request.resource.data.role == 'user' &&
              request.resource.data.balance == 0;
```

---

### ğŸ’° 2. Top-up Balance Process (à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: User à¹€à¸‚à¹‰à¸²à¸«à¸™à¹‰à¸² Top-up (src/pages/TopUp.tsx)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: à¸£à¸°à¸šà¸¸à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™ (à¹€à¸Šà¹ˆà¸™ 100 à¸šà¸²à¸—)                         â”‚
â”‚ - Input validation (> 0)                                      â”‚
â”‚ - Generate QR Code                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Generate PromptPay QR Code                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Frontend Call:                                          â”‚   â”‚
â”‚ â”‚ generatePromptPayQRCode({                               â”‚   â”‚
â”‚ â”‚   code: "0902369994",  // PromptPay number             â”‚   â”‚
â”‚ â”‚   type: "phone_number",                                 â”‚   â”‚
â”‚ â”‚   amount: 100                                           â”‚   â”‚
â”‚ â”‚ })                                                      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Slip2Go API (via Direct Call):                         â”‚   â”‚
â”‚ â”‚ POST https://connect.slip2go.com/api/qrcode/promptpay  â”‚   â”‚
â”‚ â”‚ Headers:                                                â”‚   â”‚
â”‚ â”‚   Authorization: Bearer 48eneHJp...                    â”‚   â”‚
â”‚ â”‚ Body:                                                   â”‚   â”‚
â”‚ â”‚   {                                                     â”‚   â”‚
â”‚ â”‚     "code": "0902369994",                              â”‚   â”‚
â”‚ â”‚     "type": "phone_number",                            â”‚   â”‚
â”‚ â”‚     "amount": 100                                       â”‚   â”‚
â”‚ â”‚   }                                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Response:                                               â”‚   â”‚
â”‚ â”‚ {                                                       â”‚   â”‚
â”‚ â”‚   "success": true,                                      â”‚   â”‚
â”‚ â”‚   "data": {                                             â”‚   â”‚
â”‚ â”‚     "qrImage": "data:image/png;base64,iVBORw0KG...",   â”‚   â”‚
â”‚ â”‚     "qrRawData": "00020101021129370016A000..."         â”‚   â”‚
â”‚ â”‚   }                                                     â”‚   â”‚
â”‚ â”‚ }                                                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: User à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¸œà¹ˆà¸²à¸™ Mobile Banking                       â”‚
â”‚ - à¸ªà¹à¸à¸™ QR Code                                               â”‚
â”‚ - à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹‚à¸­à¸™                                                â”‚
â”‚ - à¹„à¸”à¹‰ slip (à¸£à¸¹à¸›à¸«à¸¥à¸±à¸à¸à¸²à¸™à¸à¸²à¸£à¹‚à¸­à¸™)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: User à¸­à¸±à¸à¹‚à¸«à¸¥à¸” Slip à¹€à¸à¸·à¹ˆà¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Frontend: fileToBase64(file)                           â”‚   â”‚
â”‚ â”‚ - à¸­à¹ˆà¸²à¸™à¹„à¸Ÿà¸¥à¹Œà¸£à¸¹à¸›à¹€à¸›à¹‡à¸™ Base64                               â”‚   â”‚
â”‚ â”‚ - à¹€à¸à¹‡à¸š prefix: "data:image/jpeg;base64,..."           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Verify Slip with Slip2Go API                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Frontend Call:                                          â”‚   â”‚
â”‚ â”‚ verifySlipByImage(base64Image, {                        â”‚   â”‚
â”‚ â”‚   amount: 100,                                          â”‚   â”‚
â”‚ â”‚   accountNumber: "0902369994"                          â”‚   â”‚
â”‚ â”‚ })                                                      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Slip2Go API:                                            â”‚   â”‚
â”‚ â”‚ POST /api/verify-slip/qr-base64/info                    â”‚   â”‚
â”‚ â”‚ Headers:                                                â”‚   â”‚
â”‚ â”‚   Authorization: Bearer 48eneHJp...                    â”‚   â”‚
â”‚ â”‚ Body:                                                   â”‚   â”‚
â”‚ â”‚   {                                                     â”‚   â”‚
â”‚ â”‚     "payload": {                                        â”‚   â”‚
â”‚ â”‚       "imageBase64": "data:image/jpeg;base64,...",     â”‚   â”‚
â”‚ â”‚       "checkCondition": {                              â”‚   â”‚
â”‚ â”‚         "amount": 100,                                  â”‚   â”‚
â”‚ â”‚         "accountNumber": "0902369994"                  â”‚   â”‚
â”‚ â”‚       }                                                 â”‚   â”‚
â”‚ â”‚     }                                                   â”‚   â”‚
â”‚ â”‚   }                                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Response (Success):                                     â”‚   â”‚
â”‚ â”‚ {                                                       â”‚   â”‚
â”‚ â”‚   "success": true,                                      â”‚   â”‚
â”‚ â”‚   "data": {                                             â”‚   â”‚
â”‚ â”‚     "amount": 100,                                      â”‚   â”‚
â”‚ â”‚     "transRef": "SG202512080001",                      â”‚   â”‚
â”‚ â”‚     "sender": {                                         â”‚   â”‚
â”‚ â”‚       "displayName": "à¸™à¸²à¸¢ à¸¥à¸¹à¸à¸„à¹‰à¸² à¸—à¸”à¸ªà¸­à¸š",              â”‚   â”‚
â”‚ â”‚       "account": { "value": "1234567890" }             â”‚   â”‚
â”‚ â”‚     },                                                  â”‚   â”‚
â”‚ â”‚     "receiver": {                                       â”‚   â”‚
â”‚ â”‚       "displayName": "à¸šà¸£à¸´à¸©à¸±à¸— à¸ªà¸¥à¸´à¸›à¸—à¸¹à¹‚à¸ à¸ˆà¸³à¸à¸±à¸”",         â”‚   â”‚
â”‚ â”‚       "account": { "value": "0902369994" }             â”‚   â”‚
â”‚ â”‚     },                                                  â”‚   â”‚
â”‚ â”‚     "date": "2025-12-08T12:00:00Z"                     â”‚   â”‚
â”‚ â”‚   }                                                     â”‚   â”‚
â”‚ â”‚ }                                                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Update User Balance in Firestore                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Frontend Code:                                          â”‚   â”‚
â”‚ â”‚                                                         â”‚   â”‚
â”‚ â”‚ const userRef = doc(db, 'users', currentUser.uid);     â”‚   â”‚
â”‚ â”‚ await updateDoc(userRef, {                              â”‚   â”‚
â”‚ â”‚   balance: increment(100),  // à¹€à¸à¸´à¹ˆà¸¡ 100 à¸šà¸²à¸—          â”‚   â”‚
â”‚ â”‚   updatedAt: serverTimestamp()                         â”‚   â”‚
â”‚ â”‚ });                                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ Firestore Rule à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰:                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ allow update: if isOwner(userId) &&                     â”‚   â”‚
â”‚ â”‚                 request.resource.data.diff(resource.data)â”‚   â”‚
â”‚ â”‚                   .affectedKeys().hasAny(['balance'])   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: Create Transaction Record                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ await addDoc(collection(db, 'topup_transactions'), {    â”‚   â”‚
â”‚ â”‚   userId: currentUser.uid,                              â”‚   â”‚
â”‚ â”‚   amount: 100,                                          â”‚   â”‚
â”‚ â”‚   type: 'topup',                                        â”‚   â”‚
â”‚ â”‚   status: 'completed',                                  â”‚   â”‚
â”‚ â”‚   slipRef: slipData.transRef,                          â”‚   â”‚
â”‚ â”‚   createdAt: serverTimestamp(),                        â”‚   â”‚
â”‚ â”‚   updatedAt: serverTimestamp()                         â”‚   â”‚
â”‚ â”‚ });                                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ Firestore Rule:                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ allow create: if isAuthenticated() &&                   â”‚   â”‚
â”‚ â”‚                 request.resource.data.userId ==         â”‚   â”‚
â”‚ â”‚                   request.auth.uid &&                   â”‚   â”‚
â”‚ â”‚                 isNotSuspended()                        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: Show Success Message                                  â”‚
â”‚ - à¹à¸ªà¸”à¸‡ Toast notification                                     â”‚
â”‚ - Refresh balance display                                     â”‚
â”‚ - Redirect to home page                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡:**
- `src/pages/TopUp.tsx` - UI à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™
- `src/lib/slip2goUtils.ts` - Slip2Go API functions
- `src/lib/balanceUtils.ts` - Update balance logic
- `firestore.rules` (lines 285-297) - Transaction rules

---

### ğŸ® 3. Purchase Game/Item Process (à¸‹à¸·à¹‰à¸­à¹€à¸à¸¡)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: User à¹€à¸¥à¸·à¸­à¸à¹€à¸à¸¡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸‹à¸·à¹‰à¸­                           â”‚
â”‚ - à¹€à¸‚à¹‰à¸²à¸«à¸™à¹‰à¸² Products (src/pages/Products.tsx)                 â”‚
â”‚ - à¸”à¸¹à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¡à¸ˆà¸²à¸ Firestore                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Fetch Games from Peamsub (à¸œà¹ˆà¸²à¸™ Backend Proxy)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Frontend Call:                                          â”‚   â”‚
â”‚ â”‚ getPeamsubGames()                                       â”‚   â”‚
â”‚ â”‚                                                         â”‚   â”‚
â”‚ â”‚ const token = await auth.currentUser.getIdToken();     â”‚   â”‚
â”‚ â”‚ fetch('/api/peamsub', {                                 â”‚   â”‚
â”‚ â”‚   method: 'POST',                                       â”‚   â”‚
â”‚ â”‚   headers: {                                            â”‚   â”‚
â”‚ â”‚     'Content-Type': 'application/json',                â”‚   â”‚
â”‚ â”‚     'Authorization': `Bearer ${token}`                 â”‚   â”‚
â”‚ â”‚   },                                                    â”‚   â”‚
â”‚ â”‚   body: JSON.stringify({                               â”‚   â”‚
â”‚ â”‚     endpoint: '/v2/game',                              â”‚   â”‚
â”‚ â”‚     method: 'GET'                                       â”‚   â”‚
â”‚ â”‚   })                                                    â”‚   â”‚
â”‚ â”‚ });                                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Backend Proxy Processing (api/peamsub.ts)             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ 1. à¸£à¸±à¸š request à¸ˆà¸²à¸ frontend                            â”‚   â”‚
â”‚ â”‚ 2. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Firebase token:                             â”‚   â”‚
â”‚ â”‚    - Decode JWT                                         â”‚   â”‚
â”‚ â”‚    - Verify signature                                   â”‚   â”‚
â”‚ â”‚    - Check expiry (< 1 hour)                           â”‚   â”‚
â”‚ â”‚ 3. à¸”à¸¶à¸‡ API key à¸ˆà¸²à¸ environment:                        â”‚   â”‚
â”‚ â”‚    const PEAMSUB_API_KEY = process.env.PEAMSUB_API_KEY â”‚   â”‚
â”‚ â”‚ 4. à¸ªà¸£à¹‰à¸²à¸‡ Basic Auth:                                   â”‚   â”‚
â”‚ â”‚    Authorization: Basic base64(API_KEY + ':')          â”‚   â”‚
â”‚ â”‚ 5. Forward request à¹„à¸› Peamsub:                         â”‚   â”‚
â”‚ â”‚    GET https://api.peamsub24hr.com/v2/game             â”‚   â”‚
â”‚ â”‚ 6. Return response à¸à¸¥à¸±à¸šà¹„à¸› frontend                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Peamsub API Response                                  â”‚
â”‚ {                                                             â”‚
â”‚   "data": [                                                   â”‚
â”‚     {                                                         â”‚
â”‚       "id": 1,                                                â”‚
â”‚       "name": "Free Fire - 100 Diamonds",                    â”‚
â”‚       "price": 50,                                            â”‚
â”‚       "image": "https://...",                                â”‚
â”‚       "category": "Mobile Game"                              â”‚
â”‚     },                                                        â”‚
â”‚     {                                                         â”‚
â”‚       "id": 2,                                                â”‚
â”‚       "name": "ROV - 500 Voucher",                           â”‚
â”‚       "price": 100,                                           â”‚
â”‚       "image": "https://..."                                 â”‚
â”‚     }                                                         â”‚
â”‚   ]                                                           â”‚
â”‚ }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: User à¸„à¸¥à¸´à¸ "à¸‹à¸·à¹‰à¸­" (ProductDetailsDialog.tsx)          â”‚
â”‚ - à¹ƒà¸ªà¹ˆ UID/Username à¸‚à¸­à¸‡à¹€à¸à¸¡                                    â”‚
â”‚ - à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸‹à¸·à¹‰à¸­                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Check User Balance                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ const userDoc = await getDoc(                           â”‚   â”‚
â”‚ â”‚   doc(db, 'users', currentUser.uid)                     â”‚   â”‚
â”‚ â”‚ );                                                      â”‚   â”‚
â”‚ â”‚ const balance = userDoc.data().balance;                â”‚   â”‚
â”‚ â”‚                                                         â”‚   â”‚
â”‚ â”‚ if (balance < itemPrice) {                              â”‚   â”‚
â”‚ â”‚   toast.error('à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™à¹„à¸¡à¹ˆà¹€à¸à¸µà¸¢à¸‡à¸à¸­');                     â”‚   â”‚
â”‚ â”‚   return;                                               â”‚   â”‚
â”‚ â”‚ }                                                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Call Peamsub Top-up API (à¸œà¹ˆà¸²à¸™ Backend)               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Frontend:                                               â”‚   â”‚
â”‚ â”‚ fetch('/api/peamsub', {                                 â”‚   â”‚
â”‚ â”‚   method: 'POST',                                       â”‚   â”‚
â”‚ â”‚   headers: {                                            â”‚   â”‚
â”‚ â”‚     'Authorization': `Bearer ${token}`                 â”‚   â”‚
â”‚ â”‚   },                                                    â”‚   â”‚
â”‚ â”‚   body: JSON.stringify({                               â”‚   â”‚
â”‚ â”‚     endpoint: '/v2/game',                              â”‚   â”‚
â”‚ â”‚     method: 'POST',                                     â”‚   â”‚
â”‚ â”‚     body: {                                             â”‚   â”‚
â”‚ â”‚       id: 1,                // Product ID              â”‚   â”‚
â”‚ â”‚       uid: "player123456",  // Game UID                â”‚   â”‚
â”‚ â”‚       reference: "order_1733571234567"  // Unique ID   â”‚   â”‚
â”‚ â”‚     }                                                   â”‚   â”‚
â”‚ â”‚   })                                                    â”‚   â”‚
â”‚ â”‚ });                                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ Backend forwards to:                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ POST https://api.peamsub24hr.com/v2/game               â”‚   â”‚
â”‚ â”‚ Headers:                                                â”‚   â”‚
â”‚ â”‚   Authorization: Basic cWd3dnNo...                     â”‚   â”‚
â”‚ â”‚ Body:                                                   â”‚   â”‚
â”‚ â”‚   { id: 1, uid: "player123456", reference: "order_..." }â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ Response:                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ {                                                       â”‚   â”‚
â”‚ â”‚   "success": true,                                      â”‚   â”‚
â”‚ â”‚   "message": "Top-up successful",                      â”‚   â”‚
â”‚ â”‚   "reference": "order_1733571234567",                  â”‚   â”‚
â”‚ â”‚   "status": "completed"                                â”‚   â”‚
â”‚ â”‚ }                                                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: Deduct Balance & Record Purchase                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ // 1. à¸«à¸±à¸ balance                                      â”‚   â”‚
â”‚ â”‚ await updateDoc(doc(db, 'users', currentUser.uid), {   â”‚   â”‚
â”‚ â”‚   balance: increment(-itemPrice),  // -50 à¸šà¸²à¸—         â”‚   â”‚
â”‚ â”‚   updatedAt: serverTimestamp()                         â”‚   â”‚
â”‚ â”‚ });                                                     â”‚   â”‚
â”‚ â”‚                                                         â”‚   â”‚
â”‚ â”‚ // 2. à¸šà¸±à¸™à¸—à¸¶à¸ purchase history                          â”‚   â”‚
â”‚ â”‚ await addDoc(collection(db, 'peamsub_purchases'), {    â”‚   â”‚
â”‚ â”‚   userId: currentUser.uid,                              â”‚   â”‚
â”‚ â”‚   productId: 1,                                         â”‚   â”‚
â”‚ â”‚   productName: "Free Fire - 100 Diamonds",            â”‚   â”‚
â”‚ â”‚   gameUid: "player123456",                             â”‚   â”‚
â”‚ â”‚   price: 50,                                            â”‚   â”‚
â”‚ â”‚   reference: "order_1733571234567",                    â”‚   â”‚
â”‚ â”‚   status: "completed",                                 â”‚   â”‚
â”‚ â”‚   createdAt: serverTimestamp()                         â”‚   â”‚
â”‚ â”‚ });                                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: Success!                                              â”‚
â”‚ - à¹à¸ªà¸”à¸‡ success message                                        â”‚
â”‚ - Refresh balance                                             â”‚
â”‚ - à¹à¸ªà¸”à¸‡ purchase history                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡:**
- `src/pages/Products.tsx` - UI à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸´à¸™à¸„à¹‰à¸²
- `src/components/ProductDetailsDialog.tsx` - Dialog à¸‹à¸·à¹‰à¸­à¸ªà¸´à¸™à¸„à¹‰à¸²
- `src/lib/peamsubUtils.ts` - Peamsub API functions
- `api/peamsub.ts` - Backend proxy
- `firestore.rules` - Purchase permissions

---

### ğŸ‘¨â€ğŸ’¼ 4. Admin Add Money to User (Admin à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™à¹ƒà¸«à¹‰ User)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Admin à¹€à¸‚à¹‰à¸²à¸«à¸™à¹‰à¸² Users Management                       â”‚
â”‚ - src/pages/Users.tsx                                         â”‚
â”‚ - à¸”à¸¹à¸£à¸²à¸¢à¸à¸²à¸£ users à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Fetch All Users (Admin Only)                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ const usersRef = collection(db, 'users');               â”‚   â”‚
â”‚ â”‚ const snapshot = await getDocs(usersRef);               â”‚   â”‚
â”‚ â”‚                                                         â”‚   â”‚
â”‚ â”‚ // Firestore Rule:                                      â”‚   â”‚
â”‚ â”‚ allow read: if isOwner(userId) || isAdmin();           â”‚   â”‚
â”‚ â”‚                                                         â”‚   â”‚
â”‚ â”‚ // Admin à¹€à¸«à¹‡à¸™à¸—à¸¸à¸à¸„à¸™, User à¹€à¸«à¹‡à¸™à¹à¸„à¹ˆà¸•à¸±à¸§à¹€à¸­à¸‡                 â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Admin à¹€à¸¥à¸·à¸­à¸ User à¹à¸¥à¸°à¸„à¸¥à¸´à¸ "à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™"                  â”‚
â”‚ - à¹€à¸›à¸´à¸” Dialog (TopUpUserDialog)                              â”‚
â”‚ - à¹ƒà¸ªà¹ˆà¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™ (à¹€à¸Šà¹ˆà¸™ 500 à¸šà¸²à¸—)                                â”‚
â”‚ - à¹ƒà¸ªà¹ˆà¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ (optional)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Admin Confirms Top-up                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ const handleTopUpUser = async () => {                   â”‚   â”‚
â”‚ â”‚   // 1. à¸­à¸±à¸à¹€à¸”à¸— balance à¸‚à¸­à¸‡ user                        â”‚   â”‚
â”‚ â”‚   const userRef = doc(db, 'users', selectedUser.id);   â”‚   â”‚
â”‚ â”‚   await updateDoc(userRef, {                            â”‚   â”‚
â”‚ â”‚     balance: increment(500),  // +500 à¸šà¸²à¸—              â”‚   â”‚
â”‚ â”‚     updatedAt: serverTimestamp()                       â”‚   â”‚
â”‚ â”‚   });                                                   â”‚   â”‚
â”‚ â”‚                                                         â”‚   â”‚
â”‚ â”‚   // Firestore Rule:                                    â”‚   â”‚
â”‚ â”‚   allow update: if isAdmin();  âœ…                       â”‚   â”‚
â”‚ â”‚   // Admin à¹à¸à¹‰à¹„à¸”à¹‰à¸—à¸¸à¸ field à¸£à¸§à¸¡ balance                â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Create Transaction Record                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ await addDoc(collection(db, 'topup_transactions'), {    â”‚   â”‚
â”‚ â”‚   userId: selectedUser.id,  // User à¸—à¸µà¹ˆà¸–à¸¹à¸à¹€à¸•à¸´à¸¡        â”‚   â”‚
â”‚ â”‚   amount: 500,                                          â”‚   â”‚
â”‚ â”‚   type: 'admin_topup',                                  â”‚   â”‚
â”‚ â”‚   status: 'completed',                                  â”‚   â”‚
â”‚ â”‚   note: 'Admin topped up manually',                    â”‚   â”‚
â”‚ â”‚   adminId: currentAdmin.uid,  // Admin à¸—à¸µà¹ˆà¹€à¸•à¸´à¸¡à¹ƒà¸«à¹‰      â”‚   â”‚
â”‚ â”‚   createdAt: serverTimestamp(),                        â”‚   â”‚
â”‚ â”‚   updatedAt: serverTimestamp()                         â”‚   â”‚
â”‚ â”‚ });                                                     â”‚   â”‚
â”‚ â”‚                                                         â”‚   â”‚
â”‚ â”‚ // Firestore Rule:                                      â”‚   â”‚
â”‚ â”‚ allow create: if isAuthenticated() &&                   â”‚   â”‚
â”‚ â”‚                 ((request.resource.data.userId ==       â”‚   â”‚
â”‚ â”‚                   request.auth.uid && isNotSuspended()) â”‚   â”‚
â”‚ â”‚                  || isAdmin());  âœ…                     â”‚   â”‚
â”‚ â”‚ // Admin à¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸«à¹‰ user à¸­à¸·à¹ˆà¸™à¹„à¸”à¹‰                         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Success & Notification                                â”‚
â”‚ - à¹à¸ªà¸”à¸‡ success toast                                          â”‚
â”‚ - Refresh users list                                          â”‚
â”‚ - User à¹€à¸«à¹‡à¸™ balance à¹€à¸à¸´à¹ˆà¸¡à¸‚à¸¶à¹‰à¸™à¸—à¸±à¸™à¸—à¸µ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Firestore Rules à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸:**

```javascript
// 1. Admin à¸­à¸±à¸à¹€à¸”à¸— user balance à¹„à¸”à¹‰
match /users/{userId} {
  allow update: if isAdmin();  // âœ… Line 69
}

// 2. Admin à¸ªà¸£à¹‰à¸²à¸‡ transaction à¹ƒà¸«à¹‰ user à¸­à¸·à¹ˆà¸™à¹„à¸”à¹‰
match /topup_transactions/{transactionId} {
  allow create: if isAuthenticated() && 
                  ((request.resource.data.userId == request.auth.uid && 
                    isNotSuspended()) ||
                   isAdmin());  // âœ… Lines 291-293
}
```

**à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡:**
- `src/pages/Users.tsx` - Admin UI
- `firestore.rules` (lines 64, 291-293) - Admin permissions

---

## ğŸ”‘ 5. Environment Variables & API Keys Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Development (.env.local)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VITE_FIREBASE_API_KEY=AIzaSyC...                          â”‚
â”‚ VITE_FIREBASE_PROJECT_ID=game-shop-72ad1                  â”‚
â”‚ (Frontend variables - prefix VITE_)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼ (Build time)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Bundle (dist/)                                    â”‚
â”‚ - VITE_ variables à¸–à¸¹à¸ replace à¹€à¸›à¹‡à¸™à¸„à¹ˆà¸²à¸ˆà¸£à¸´à¸‡                â”‚
â”‚ - à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢: à¸¡à¸µ Firestore Security Rules à¸›à¹‰à¸­à¸‡à¸à¸±à¸™            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Production (Vercel Environment Variables)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PEAMSUB_API_KEY=qgwvsh5rwvtevey8zdh4bj13                  â”‚
â”‚ SLIP2GO_API_KEY=48eneHJpZiVu2j6nutRTjJdDX61kbqdC9TbvrZ... â”‚
â”‚ (Server-side only - à¹„à¸¡à¹ˆà¸–à¸¹à¸ expose)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼ (Runtime)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel Serverless Function (api/peamsub.ts)                â”‚
â”‚                                                            â”‚
â”‚ const PEAMSUB_API_KEY = process.env.PEAMSUB_API_KEY;      â”‚
â”‚ // âœ… à¸”à¸¶à¸‡à¸ˆà¸²à¸ environment à¸•à¸­à¸™ runtime                      â”‚
â”‚ // âœ… à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸™ frontend bundle                             â”‚
â”‚ // âœ… à¹„à¸¡à¹ˆà¸–à¸¹à¸ log à¹ƒà¸™ console (terser à¸¥à¸šà¹à¸¥à¹‰à¸§)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**à¸à¸²à¸£à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ API Keys:**

1. **Frontend:**
   - à¹„à¸¡à¹ˆà¸¡à¸µ `PEAMSUB_API_KEY` à¸«à¸£à¸·à¸­ `SLIP2GO_API_KEY`
   - à¹ƒà¸Šà¹‰à¹à¸„à¹ˆ Firebase config (à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢)
   - API calls à¸œà¹ˆà¸²à¸™ `/api/peamsub` (backend proxy)

2. **Backend:**
   - API keys à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ Vercel environment variables
   - à¸”à¸¶à¸‡à¸œà¹ˆà¸²à¸™ `process.env.PEAMSUB_API_KEY`
   - à¹„à¸¡à¹ˆà¸–à¸¹à¸ expose à¹„à¸›à¸¢à¸±à¸‡ client

3. **Production Build:**
   - Terser à¸¥à¸š `console.log` à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
   - Bundle à¹„à¸¡à¹ˆà¸¡à¸µ sensitive data
   - Gzipped à¹€à¸à¸·à¹ˆà¸­à¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸

---

## ğŸ›¡ï¸ 6. Security Layers

### Layer 1: Firebase Authentication
```
âœ… JWT Token validation (exp: 1 hour)
âœ… Verify signature
âœ… Check user status (not suspended)
```

### Layer 2: Firestore Security Rules
```
âœ… isAuthenticated() - à¸•à¹‰à¸­à¸‡ login
âœ… isOwner() - à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
âœ… isAdmin() - admin only
âœ… isNotSuspended() - à¹„à¸¡à¹ˆà¸–à¸¹à¸ ban
```

### Layer 3: Backend Proxy
```
âœ… API keys à¸‹à¹ˆà¸­à¸™à¹ƒà¸™ server
âœ… Validate Firebase token à¸—à¸¸à¸ request
âœ… CORS protection
âœ… Rate limiting (Vercel default)
```

### Layer 4: Production Build
```
âœ… Console.log removed (terser)
âœ… Minified & gzipped
âœ… No hardcoded secrets
âœ… Environment variables only
```

---

## ğŸ“Š 7. Data Flow Summary

```
USER ACTION â†’ FRONTEND â†’ FIREBASE AUTH â†’ BACKEND PROXY â†’ EXTERNAL API
                 â†“           â†“              â†“               â†“
           React UI    Get JWT Token   Validate Token   Add API Key
                 â†“           â†“              â†“               â†“
           Components  Return User    Forward Request  Return Data
                 â†“           â†“              â†“               â†“
           Update UI   Store in       Update Firestore  Update Balance
                       Context              â†“
                                     Security Rules Check
                                            â†“
                                      Allow/Deny
```

---

## ğŸ“ à¸ªà¸£à¸¸à¸›à¸ªà¸³à¸„à¸±à¸

### à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢:
âœ… **API Keys à¹„à¸¡à¹ˆà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ Frontend** - à¸‹à¹ˆà¸­à¸™à¹ƒà¸™ Vercel environment  
âœ… **Firebase Rules à¸„à¸£à¸­à¸šà¸„à¸¥à¸¸à¸¡** - à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸­à¸™à¸¸à¸à¸²à¸•  
âœ… **Backend Proxy** - Validate token à¸à¹ˆà¸­à¸™à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­  
âœ… **Production Build à¸ªà¸°à¸­à¸²à¸”** - à¹„à¸¡à¹ˆà¸¡à¸µ console.log à¸«à¸£à¸·à¸­ secrets  

### Performance:
âœ… **Code Splitting** - à¹à¸¢à¸ vendor chunks (React, Firebase, UI)  
âœ… **Gzip Compression** - Bundle size à¸¥à¸”à¸¥à¸‡ 27 KB  
âœ… **CDN (Vercel Edge)** - Fast global delivery  
âœ… **Firestore Indexing** - Query optimization  

### User Experience:
âœ… **Real-time Updates** - Firestore realtime listeners  
âœ… **Loading States** - Skeleton, spinners  
âœ… **Error Handling** - Toast notifications  
âœ… **Responsive Design** - Mobile-friendly  

---

**à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸¡à¸·à¹ˆà¸­:** 8 à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡ 2025  
**à¸ªà¸³à¸«à¸£à¸±à¸š:** à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸£à¸°à¸šà¸š Coin-Zone à¹à¸šà¸šà¸¥à¸°à¹€à¸­à¸µà¸¢à¸”  
**à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™:** 2.0 (Production Ready)

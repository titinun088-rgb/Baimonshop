# Slip History Management Guide

## ภาพรวม

ระบบประวัติสลิปการโอนเงิน (Slip History) ช่วยให้ผู้ใช้สามารถจัดการและดูประวัติสลิปการโอนเงินที่เคยตรวจสอบแล้วได้อย่างมีประสิทธิภาพ

## ฟีเจอร์หลัก

### 1. การดึงข้อมูลสลิปเก่า
- **Endpoint**: `GET https://connect.slip2go.com/api/verify-slip/{referenceId}`
- **Authentication**: Bearer Token
- **การใช้งาน**: ใช้ Reference ID ที่ได้จากการตรวจสอบสลิปครั้งแรก
- **ดึงภาพสลิป**: เก็บ/แนบ `imageUrl` (ถ้ามี) ไว้ในประวัติพร้อมกับ `referenceId` เพื่อแสดงผลภายหลัง

### 2. การจัดการประวัติสลิป
- **เพิ่มสลิปใหม่**: ใช้ Reference ID เพื่อดึงข้อมูลสลิปและเพิ่มในประวัติ
- **ค้นหาสลิป**: ค้นหาด้วย Reference ID, ชื่อผู้ส่ง/รับ, หรือรหัสธนาคาร
- **ลบสลิป**: ลบสลิปออกจากประวัติ
- **ล้างประวัติ**: ลบประวัติทั้งหมด

### 3. การแสดงข้อมูลสลิป
- **ข้อมูลพื้นฐาน**: จำนวนเงิน, วันที่, ผู้ส่ง/รับ
- **ข้อมูลธนาคาร**: ชื่อธนาคาร, หมายเลขบัญชี
- **ข้อมูลเพิ่มเติม**: Ref1, Ref2, Ref3 (ถ้ามี)
- **การคัดลอก**: คัดลอกข้อมูลต่างๆ ได้ง่าย

### 4. การดึงภาพสลิป (แนะนำ)
- หากตรวจสอบด้วยรูปภาพ/ลิงก์ ให้บันทึก `imageUrl` ที่ใช้ตรวจสอบไว้กับรายการประวัติสลิป
- หากอัปโหลดไฟล์ภาพ ให้เก็บเป็น Base64 ชั่วคราวหรืออัปโหลดขึ้น Storage แล้วเก็บ URL กลับมาเป็น `imageUrl`
- ตัวอย่างการเรนเดอร์ภาพใน React:
```tsx
{selectedSlip?.imageUrl && (
  <img
    src={selectedSlip.imageUrl}
    alt={`Slip ${selectedSlip.referenceId}`}
    className="w-full max-w-md rounded border"
  />
)}
```

## การใช้งาน

### 1. เข้าสู่หน้าประวัติสลิป
```
/slip-history
```

### 2. เพิ่มสลิปใหม่
1. กรอก Reference ID ในช่องค้นหา
2. คลิก "ค้นหาสลิป"
3. ระบบจะดึงข้อมูลและเพิ่มในประวัติอัตโนมัติ

### 3. ค้นหาสลิปในประวัติ
1. ใช้ช่องค้นหา "ค้นหาในประวัติ"
2. ค้นหาด้วย:
   - Reference ID
   - ชื่อผู้ส่ง/รับ
   - รหัสธนาคาร

### 4. ดูรายละเอียดสลิป
1. คลิกที่สลิปในรายการ
2. ดูรายละเอียดครบถ้วนในแผงด้านขวา
3. คัดลอกข้อมูลที่ต้องการ

## API Response Format

### Success Response (code: "200001")
```json
{
  "code": "200001",
  "message": "Get Info Success",
  "data": {
    "referenceId": "92887bd5-60d3-4744-9a98-b8574eaxxxxx-xx",
    "decode": "00020101021129370016A0000006770101120114200242805291300496850103714406410707",
    "transRef": "015073144014FAT0099Y",
    "dateTime": "2025-04-23T08:32:45.123Z",
    "verifyDate": "2025-04-23T08:32:45.123Z",
    "amount": 100.00,
    "ref1": "xxx",
    "ref2": "xxx", 
    "ref3": "xxx",
    "receiver": {
      "account": {
        "name": "บริษัท สลิปทูโก จำกัด",
        "bank": {
          "account": "xxxx-x-5366-x"
        },
        "proxy": {
          "type": "NATID",
          "account": "xxxx-x-5366-x"
        }
      },
      "bank": {
        "id": "004",
        "name": "ธนาคารกสิกรไทย"
      }
    },
    "sender": {
      "account": {
        "name": "บริษัท สลิปทูโก จำกัด",
        "bank": {
          "account": "xxxx-x-9866-x"
        }
      },
      "bank": {
        "id": "004",
        "name": "ธนาคารกสิกรไทย"
      }
    }
  }
}
```

## ข้อมูลที่แสดง

### ข้อมูลหลัก
- **จำนวนเงิน**: แสดงในรูปแบบสกุลเงินไทย
- **วันที่ทำรายการ**: วันที่และเวลาที่ทำการโอนเงิน
- **วันที่ตรวจสอบ**: วันที่ที่ตรวจสอบสลิป (ถ้ามี)

### ข้อมูลผู้รับ
- **ธนาคารผู้รับ**: ชื่อธนาคารและรหัสธนาคาร
- **หมายเลขบัญชีผู้รับ**: เลขที่บัญชีธนาคาร
- **ชื่อบัญชีผู้รับ**: ชื่อเจ้าของบัญชี

### ข้อมูลผู้ส่ง
- **ธนาคารผู้ส่ง**: ชื่อธนาคารและรหัสธนาคาร
- **หมายเลขบัญชีผู้ส่ง**: เลขที่บัญชีธนาคาร
- **ชื่อผู้ส่ง**: ชื่อเจ้าของบัญชี

### ข้อมูลอ้างอิง
- **รหัสอ้างอิงธนาคาร**: รหัสอ้างอิงจากธนาคาร
- **รหัสอ้างอิงสลิป**: Reference ID ของสลิป
- **Ref1, Ref2, Ref3**: ข้อมูลเพิ่มเติม (ถ้ามี)

## การจัดการข้อมูล

### Local Storage
- ประวัติสลิปจะถูกบันทึกใน Local Storage
- ข้อมูลจะคงอยู่แม้ปิดเบราว์เซอร์
- สามารถล้างข้อมูลได้ด้วยปุ่ม "ล้างประวัติ"

### การค้นหา
- ค้นหาแบบ Real-time
- รองรับการค้นหาด้วยหลายเงื่อนไข
- แสดงผลลัพธ์ทันที

### การคัดลอกข้อมูล
- คัดลอกข้อมูลแต่ละฟิลด์ได้
- แสดงข้อความยืนยันเมื่อคัดลอกสำเร็จ
- รองรับการคัดลอกข้อมูลทั้งหมด

## การจัดการข้อผิดพลาด

### Error Handling
- **ไม่พบข้อมูล**: แสดงข้อความ "ไม่พบข้อมูลสลิป"
- **ข้อผิดพลาด API**: แสดงข้อความข้อผิดพลาดจาก API
- **ข้อผิดพลาดเครือข่าย**: แสดงข้อความ "เกิดข้อผิดพลาดในการดึงข้อมูลสลิป"

### User Feedback
- แสดง Loading state ขณะดึงข้อมูล
- แสดง Toast notification สำหรับการดำเนินการ
- แสดง Alert สำหรับข้อผิดพลาด

## การใช้งานในระบบ

### 1. ตรวจสอบสลิปใหม่
- ไปที่หน้า "ตรวจสอบสลิป" (/slip-verification)
- เลือกวิธีการตรวจสอบ (QR Code, รูปภาพ, หรือ Reference ID)
- ตรวจสอบสลิปและบันทึก Reference ID

### 2. ดูประวัติสลิป
- ไปที่หน้า "ประวัติสลิป" (/slip-history)
- ใช้ Reference ID เพื่อดึงข้อมูลสลิปเก่า
- จัดการและค้นหาสลิปในประวัติ

#### แนวทางจัดเก็บภาพในประวัติ
- เก็บโครงสร้างข้อมูล เช่น `{ referenceId, amount, dateTime, imageUrl? }`
- เมื่อดึงกลับมาแสดง ให้ตรวจสอบ `imageUrl` แล้วเรนเดอร์ภาพตามตัวอย่างด้านบน

### 3. การเชื่อมต่อกับระบบอื่น
- ระบบประวัติสลิปเชื่อมต่อกับระบบตรวจสอบสลิป
- ข้อมูลสลิปจะถูกบันทึกใน Local Storage
- สามารถใช้ Reference ID เพื่อดึงข้อมูลสลิปเก่าได้

## ข้อดีของระบบ

### 1. ความสะดวก
- ไม่ต้องตรวจสอบสลิปซ้ำ
- ดูประวัติสลิปได้ง่าย
- ค้นหาสลิปได้รวดเร็ว

### 2. ความแม่นยำ
- ข้อมูลจาก Slip2Go API
- ข้อมูลครบถ้วนและถูกต้อง
- รองรับข้อมูลเพิ่มเติม

### 3. การจัดการ
- จัดการประวัติได้ง่าย
- ลบสลิปที่ไม่ต้องการได้
- คัดลอกข้อมูลได้สะดวก

## การพัฒนาเพิ่มเติม

### 1. การส่งออกข้อมูล
- ส่งออกเป็น Excel/CSV
- ส่งออกเป็น PDF
- ส่งออกเป็น JSON

### 2. การกรองข้อมูล
- กรองตามวันที่
- กรองตามจำนวนเงิน
- กรองตามธนาคาร

### 3. การแจ้งเตือน
- แจ้งเตือนสลิปใหม่
- แจ้งเตือนสลิปที่ใกล้หมดอายุ
- แจ้งเตือนข้อผิดพลาด

## สรุป

ระบบประวัติสลิปการโอนเงินเป็นเครื่องมือที่มีประโยชน์สำหรับการจัดการสลิปการโอนเงิน โดยให้ความสะดวก ความแม่นยำ และการจัดการที่ดี ทำให้ผู้ใช้สามารถจัดการสลิปได้อย่างมีประสิทธิภาพ

